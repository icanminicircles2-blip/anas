<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… I CAN - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø´Ø§Ù…Ù„Ø©</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { background: linear-gradient(135deg, #004d40, #002f6c); color: white; font-family: 'Segoe UI', Tahoma, sans-serif; min-height: 100vh; }
        .screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; padding: 20px; overflow-y: auto; }
        .hidden { display: none !important; }
        .container { background: rgba(255, 255, 255, 0.15); padding: 25px; border-radius: 20px; backdrop-filter: blur(15px); width: 95%; max-width: 500px; margin-top: 50px; text-align: center; }
        .main-btn { padding: 20px; font-size: 22px; border: none; border-radius: 12px; cursor: pointer; color: white; width: 100%; margin-bottom: 15px; font-weight: bold; }
        .admin-btn { background: #9c27b0; }
        .spec-btn { background: #2196f3; }
        .action-btn { padding: 12px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; background: #4CAF50; color: white; margin: 5px; width: 90%; }
        input { padding: 12px; border-radius: 8px; border: none; width: 90%; margin: 10px 0; font-size: 16px; }
        .item-row { background: white; color: #333; padding: 10px; margin: 5px 0; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; }
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
        @media print {
            body * { visibility: hidden; }
            #printArea, #printArea * { visibility: visible; }
            #printArea { position: absolute; left: 0; top: 0; width: 100%; color: black; background: white; padding: 20px; }
            table { width: 100%; border-collapse: collapse; margin-top: 20px; }
            th, td { border: 1px solid black; padding: 10px; text-align: center; }
        }
    </style>
</head>
<body>

    <div id="mainScreen" class="screen">
        <h1 style="margin-top: 100px; font-size: 50px;">I CAN ğŸ“±</h1>
        <div class="container">
            <button class="main-btn admin-btn" onclick="showScreen('adminLoginScreen')">ğŸ‘‘ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠØ±</button>
            <button class="main-btn spec-btn" onclick="showScreen('specialistMonthScreen')">ğŸ‘¤ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠ</button>
        </div>
    </div>

    <div id="adminControlPanel" class="screen hidden">
        <div class="container">
            <button onclick="showScreen('mainScreen')" style="background:#555; color:white; border:none; padding:8px 15px; border-radius:5px; float:left;">ğŸ”™</button>
            <h3>ğŸ‘¨â€ğŸ’¼ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h3>
            <input type="text" id="newSpecName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠ Ø£Ùˆ Ø§Ù„Ø®Ø·Ø©">
            <button class="action-btn" onclick="addSpecialist()">â• Ø¥Ø¶Ø§ÙØ©</button>
            
            <div id="specialistsList" style="margin: 20px 0;"></div>

            <button class="action-btn" style="background:#17a2b8" onclick="viewReports()">ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø·Ø¨Ø§Ø¹Ø©</button>
            
            <div style="margin-top:20px; border-top:1px solid rgba(255,255,255,0.3); padding-top:15px;">
                <button class="action-btn" style="background:#ff9800" onclick="downloadBackup()">ğŸ“¥ Ø­ÙØ¸ Ù†Ø³Ø®Ø© Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„</button>
                <label class="action-btn" style="background:#009688; display:block; margin: 5px auto; width:90%;">
                    ğŸ“¤ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ù†Ø³Ø®Ø©
                    <input type="file" id="uploadFile" style="display:none" onchange="restoreBackup(event)">
                </label>
            </div>
        </div>
    </div>

    <div id="reportScreen" class="screen hidden">
        <div class="container" id="printArea">
            <h2 style="color: #333;">ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø´Ù‡Ø±</h2>
            <div id="reportContainer" style="margin-top: 20px; color: #333;"></div>
            <button class="action-btn" id="printBtn" onclick="window.print()" style="margin-top:20px;">ğŸ–¨ï¸ Ø­ÙØ¸ ÙƒÙ€ PDF / Ø·Ø¨Ø§Ø¹Ø©</button>
            <button class="action-btn" id="backBtn" onclick="showScreen('adminControlPanel')" style="background:#555;">Ø±Ø¬ÙˆØ¹</button>
        </div>
    </div>

    <div id="adminLoginScreen" class="screen hidden">
        <div class="container">
            <h2>Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
            <input type="password" id="adminPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            <button class="action-btn" onclick="loginAdmin()">Ø¯Ø®ÙˆÙ„</button>
        </div>
    </div>

    <div id="specialistMonthScreen" class="screen hidden">
        <div class="container">
            <h3>Ø§Ø®ØªØ± Ø§Ù„Ø´Ù‡Ø±</h3>
            <div id="monthButtons" style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;"></div>
            <button class="action-btn" style="background:#555; margin-top:15px;" onclick="showScreen('mainScreen')">Ø±Ø¬ÙˆØ¹</button>
        </div>
    </div>

    <script>
        let specialists = JSON.parse(localStorage.getItem('ican_specs')) || [];
        let attendance = JSON.parse(localStorage.getItem('ican_att')) || {};
        let archive = JSON.parse(localStorage.getItem('ican_archive')) || [];
        const now = new Date();

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
            if(id === 'adminControlPanel') loadSpecsList();
            if(id === 'specialistMonthScreen') loadMonths();
        }

        function loginAdmin() {
            if(document.getElementById('adminPassword').value === "1234") showScreen('adminControlPanel');
            else alert("Ø®Ø·Ø£");
        }

        function addSpecialist() {
            const name = document.getElementById('newSpecName').value;
            if(name) {
                specialists.push({ name: name, pass: name + "1" });
                saveAndRefresh();
                document.getElementById('newSpecName').value = "";
            }
        }

        function loadSpecsList() {
            const list = document.getElementById('specialistsList');
            list.innerHTML = specialists.map((s, i) => `
                <div class="item-row">
                    <span>${s.name}</span>
                    <button onclick="deleteSpec(${i})" style="color:red; background:none; border:none; font-size:20px;">ğŸ—‘ï¸</button>
                </div>
            `).join('');
        }

        function deleteSpec(i) {
            if(confirm("Ù†Ù‚Ù„ Ù„Ù„Ø£Ø±Ø´ÙŠÙØŸ")) {
                archive.push(specialists[i]);
                specialists.splice(i, 1);
                saveAndRefresh();
            }
        }

        function saveAndRefresh() {
            localStorage.setItem('ican_specs', JSON.stringify(specialists));
            localStorage.setItem('ican_att', JSON.stringify(attendance));
            localStorage.setItem('ican_archive', JSON.stringify(archive));
            loadSpecsList();
        }

        // --- ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ§Ù„Ø·Ø¨Ø§Ø¹Ø© ---
        function downloadBackup() {
            const data = { specs: specialists, att: attendance, arc: archive };
            const blob = new Blob([JSON.stringify(data)], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `ICAN_Data_${new Date().toLocaleDateString()}.json`;
            a.click();
            alert("âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ø§Ù„ØªÙ†Ø²ÙŠÙ„Ø§Øª (Downloads)");
        }

        function restoreBackup(event) {
            const file = event.target.files[0];
            const reader = new FileReader();
            reader.onload = (e) => {
                const data = JSON.parse(e.target.result);
                specialists = data.specs || [];
                attendance = data.att || {};
                archive = data.arc || [];
                saveAndRefresh();
                alert("âœ… ØªÙ… Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©");
            };
            reader.readAsText(file);
        }

        function viewReports() {
            showScreen('reportScreen');
            const container = document.getElementById('reportContainer');
            const currentM = now.getMonth() + 1;
            
            let html = `<table><tr><th>Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠ</th><th>Ø£ÙŠØ§Ù… Ø§Ù„Ø¹Ù…Ù„</th><th>ØªØ£Ø®ÙŠØ±</th><th>Ø¥Ø¶Ø§ÙÙŠ</th></tr>`;
            
            specialists.forEach(spec => {
                let delay = 0, over = 0, days = 0;
                const mData = attendance[spec.name]?.[currentM] || {};
                Object.values(mData).forEach(d => {
                    delay += (d.delay || 0);
                    over += (d.over || 0);
                    if(d.in) days++;
                });
                html += `<tr><td>${spec.name}</td><td>${days}</td><td>${delay}Ø¯</td><td>${over}Ø¯</td></tr>`;
            });
            
            html += `</table>`;
            container.innerHTML = html;
        }

        function loadMonths() {
            const months = ["ÙŠÙ†Ø§ÙŠØ±", "ÙØ¨Ø±Ø§ÙŠØ±", "Ù…Ø§Ø±Ø³", "Ø£Ø¨Ø±ÙŠÙ„", "Ù…Ø§ÙŠÙˆ", "ÙŠÙˆÙ†ÙŠÙˆ", "ÙŠÙˆÙ„ÙŠÙˆ", "Ø£ØºØ³Ø·Ø³", "Ø³Ø¨ØªÙ…Ø¨Ø±", "Ø£ÙƒØªÙˆØ¨Ø±", "Ù†ÙˆÙÙ…Ø¨Ø±", "Ø¯ÙŠØ³Ù…Ø¨Ø±"];
            const div = document.getElementById('monthButtons');
            div.innerHTML = months.map((m, i) => `
                <button class="action-btn" style="background:#2196f3" onclick="alert('ØªÙ… Ø§Ø®ØªÙŠØ§Ø± ${m}')">${m}</button>
            `).join('');
        }
    </script>
</body>
</html>

